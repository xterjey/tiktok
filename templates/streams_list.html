<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream List - TikTok Stream Key Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'tiktok': '#FE2C55',
                        'dark-blue': '#0c1445',
                        'medium-blue': '#1e3a8a',
                        'light-blue': '#3b82f6',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #60a5fa;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        /* Glass effect */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #FE2C55);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Table styles */
        .table-row {
            transition: all 0.3s ease;
        }
        
        .table-row:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(5px);
        }
        
        /* Action button styles */
        .action-btn {
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-dark-blue via-medium-blue to-dark-blue min-h-screen text-white">
    <!-- Background Pattern -->
    <div class="fixed inset-0 opacity-10">
        <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
    </div>
    
    <!-- Navigation -->
    <nav class="glass sticky top-0 z-50 border-b border-white/10">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-light-blue to-tiktok flex items-center justify-center">
                        <i class="fas fa-broadcast-tower text-white"></i>
                    </div>
                    <h1 class="text-2xl font-bold gradient-text">TikTok Stream Generator</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all duration-300 flex items-center space-x-2">
                        <i class="fas fa-plus"></i>
                        <span>Create Stream</span>
                    </a>
                    <button id="darkModeToggle" class="p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all duration-300">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 relative z-10">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8 fade-in">
                <h2 class="text-3xl font-bold mb-2">My Streams</h2>
                <p class="text-gray-300">Manage all your TikTok streams in one place</p>
            </div>
            
            <!-- Search and Filter -->
            <div class="glass rounded-xl p-4 mb-6 fade-in" style="animation-delay: 0.1s">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="searchInput" placeholder="Search streams by title..."
                                   class="w-full pl-10 pr-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-light-blue focus:ring-2 focus:ring-light-blue/50 text-white placeholder-gray-400 transition-all duration-300">
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <select id="sortSelect" class="px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-light-blue focus:ring-2 focus:ring-light-blue/50 text-white">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="title">By Title</option>
                        </select>
                        <button onclick="location.reload()" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all duration-300">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Streams Table -->
            {% if streams %}
                <div class="glass rounded-2xl overflow-hidden shadow-2xl fade-in" style="animation-delay: 0.2s">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-white/5 border-b border-white/10">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Stream</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Created</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">RTMP URL</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Stream Key</th>
                                    <th class="px-6 py-4 text-center text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/10" id="streamsTableBody">
                                {% for stream in streams %}
                                    <tr class="table-row" data-stream-id="{{ stream.id }}">
                                        <td class="px-6 py-4">
                                            <div>
                                                <div class="font-semibold text-white">{{ stream.title }}</div>
                                                <div class="text-sm text-gray-400">{{ stream.created_date }}</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="text-sm text-gray-300">{{ stream.created_date }}</span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="font-mono text-xs bg-white/5 p-2 rounded break-all">{{ stream.baseStreamUrl }}</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="font-mono text-xs bg-white/5 p-2 rounded break-all">{{ stream.streamKey }}</div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex justify-center space-x-2">
                                                <button onclick="copyToClipboard('{{ stream.baseStreamUrl }}', 'RTMP URL')" 
                                                        class="action-btn p-2 rounded-lg bg-white/10 hover:bg-light-blue/20 text-light-blue" 
                                                        title="Copy RTMP URL">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button onclick="copyToClipboard('{{ stream.streamKey }}', 'Stream Key')" 
                                                        class="action-btn p-2 rounded-lg bg-white/10 hover:bg-tiktok/20 text-tiktok" 
                                                        title="Copy Stream Key">
                                                    <i class="fas fa-key"></i>
                                                </button>
                                                <button onclick="copyToClipboard('{{ stream.baseStreamUrl }}/{{ stream.streamKey }}', 'Full RTMP')" 
                                                        class="action-btn p-2 rounded-lg bg-white/10 hover:bg-green-500/20 text-green-400" 
                                                        title="Copy Full RTMP">
                                                    <i class="fas fa-link"></i>
                                                </button>
                                                <a href="{{ stream.streamShareUrl }}" target="_blank" 
                                                   class="action-btn p-2 rounded-lg bg-white/10 hover:bg-purple-500/20 text-purple-400" 
                                                   title="Open Stream">
                                                    <i class="fas fa-external-link-alt"></i>
                                                </a>
                                                <button onclick="confirmDelete('{{ stream.id }}')" 
                                                        class="action-btn p-2 rounded-lg bg-white/10 hover:bg-red-500/20 text-red-400" 
                                                        title="Delete Stream">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% else %}
                <!-- Empty State -->
                <div class="glass rounded-2xl p-12 text-center fade-in">
                    <i class="fas fa-inbox text-6xl text-gray-600 mb-4"></i>
                    <h3 class="text-2xl font-bold mb-2">No streams found</h3>
                    <p class="text-gray-400 mb-6">You haven't created any streams yet. Click the button below to get started.</p>
                    <a href="/" class="inline-flex items-center px-6 py-3 rounded-lg bg-gradient-to-r from-light-blue to-tiktok text-white font-semibold hover:shadow-lg transform hover:scale-105 transition-all duration-300">
                        <i class="fas fa-plus mr-2"></i>
                        Create Your First Stream
                    </a>
                </div>
            {% endif %}
            
            <!-- Instructions Card -->
            <div class="glass rounded-2xl p-6 mt-8 fade-in" style="animation-delay: 0.4s">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-light-blue"></i>
                    How to Use Stream Information
                </h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white/5 rounded-lg p-4">
                        <h4 class="font-semibold mb-3 text-light-blue flex items-center">
                            <i class="fas fa-desktop mr-2"></i>
                            For OBS Studio
                        </h4>
                        <ol class="space-y-2 text-gray-300 text-sm">
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-light-blue/20 text-light-blue flex items-center justify-center text-xs mr-2">1</span>
                                Go to Settings > Stream
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-light-blue/20 text-light-blue flex items-center justify-center text-xs mr-2">2</span>
                                Service: Custom
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-light-blue/20 text-light-blue flex items-center justify-center text-xs mr-2">3</span>
                                Server: Paste RTMP URL
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-light-blue/20 text-light-blue flex items-center justify-center text-xs mr-2">4</span>
                                Stream Key: Paste Stream Key
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-light-blue/20 text-light-blue flex items-center justify-center text-xs mr-2">5</span>
                                Click Apply and OK
                            </li>
                        </ol>
                    </div>
                    <div class="bg-white/5 rounded-lg p-4">
                        <h4 class="font-semibold mb-3 text-tiktok flex items-center">
                            <i class="fas fa-broadcast-tower mr-2"></i>
                            For Streamlabs
                        </h4>
                        <ol class="space-y-2 text-gray-300 text-sm">
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-tiktok/20 text-tiktok flex items-center justify-center text-xs mr-2">1</span>
                                Go to Settings > Stream
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-tiktok/20 text-tiktok flex items-center justify-center text-xs mr-2">2</span>
                                Platform: TikTok
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-tiktok/20 text-tiktok flex items-center justify-center text-xs mr-2">3</span>
                                Or select "Custom RTMP"
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-tiktok/20 text-tiktok flex items-center justify-center text-xs mr-2">4</span>
                                Paste RTMP URL and Stream Key
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-tiktok/20 text-tiktok flex items-center justify-center text-xs mr-2">5</span>
                                Click Done
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="glass rounded-2xl p-6 max-w-md w-full mx-4 transform transition-all">
            <div class="text-center">
                <i class="fas fa-exclamation-triangle text-5xl text-yellow-400 mb-4"></i>
                <h3 class="text-2xl font-bold mb-2">Confirm Delete</h3>
                <p class="text-gray-300 mb-6">Are you sure you want to delete this stream? This action cannot be undone.</p>
                <div class="flex space-x-4 justify-center">
                    <button onclick="closeDeleteModal()" class="px-6 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all duration-300">
                        Cancel
                    </button>
                    <button onclick="deleteStream()" class="px-6 py-2 rounded-lg bg-red-600 hover:bg-red-700 transition-all duration-300">
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 glass rounded-lg p-4 shadow-lg transform translate-y-full transition-transform duration-300 z-50">
        <div class="flex items-center space-x-3">
            <i id="toastIcon" class="fas fa-check-circle text-green-400 text-xl"></i>
            <p id="toastMessage" class="text-sm"></p>
        </div>
    </div>
    
    <script>
        // Copy to clipboard functionality
        function copyToClipboard(text, type) {
            // Modern browsers
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast(`${type} copied to clipboard!`, 'success');
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    // Fallback
                    fallbackCopyTextToClipboard(text, type);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyTextToClipboard(text, type);
            }
        }
        
        // Fallback copy method
        function fallbackCopyTextToClipboard(text, type) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast(`${type} copied to clipboard!`, 'success');
                } else {
                    showToast('Failed to copy', 'error');
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                showToast('Failed to copy', 'error');
            }
            
            document.body.removeChild(textArea);
        }
        
        // Delete functionality
        let streamToDelete = null;
        
        function confirmDelete(streamId) {
            streamToDelete = streamId;
            document.getElementById('deleteModal').classList.remove('hidden');
            document.getElementById('deleteModal').classList.add('flex');
        }
        
        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            document.getElementById('deleteModal').classList.remove('flex');
            streamToDelete = null;
        }
        
        function deleteStream() {
            if (streamToDelete) {
                fetch(`/delete_stream/${streamToDelete}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove the row from table
                        const row = document.querySelector(`tr[data-stream-id="${streamToDelete}"]`);
                        if (row) {
                            row.style.transform = 'translateX(-100%)';
                            row.style.opacity = '0';
                            setTimeout(() => {
                                row.remove();
                                
                                // Check if table is empty
                                const tbody = document.getElementById('streamsTableBody');
                                if (tbody && tbody.children.length === 0) {
                                    // Reload page to show empty state
                                    window.location.reload();
                                }
                            }, 300);
                        }
                        
                        showToast('Stream deleted successfully!', 'success');
                    } else {
                        showToast('Failed to delete stream: ' + (data.error || 'Unknown error'), 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast('Failed to delete stream', 'error');
                });
                
                closeDeleteModal();
            }
        }
        
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#streamsTableBody tr');
            
            rows.forEach(row => {
                const title = row.querySelector('.font-semibold').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
        
        // Sort functionality
        const sortSelect = document.getElementById('sortSelect');
        sortSelect.addEventListener('change', function() {
            const sortBy = this.value;
            const tbody = document.getElementById('streamsTableBody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                if (sortBy === 'newest') {
                    const dateA = new Date(a.querySelector('.text-gray-400').textContent);
                    const dateB = new Date(b.querySelector('.text-gray-400').textContent);
                    return dateB - dateA;
                } else if (sortBy === 'oldest') {
                    const dateA = new Date(a.querySelector('.text-gray-400').textContent);
                    const dateB = new Date(b.querySelector('.text-gray-400').textContent);
                    return dateA - dateB;
                } else if (sortBy === 'title') {
                    const titleA = a.querySelector('.font-semibold').textContent;
                    const titleB = b.querySelector('.font-semibold').textContent;
                    return titleA.localeCompare(titleB);
                }
                return 0;
            });
            
            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
        });
        
        // Toast notification function
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastMessage.textContent = message;
            
            // Update icon based on type
            toastIcon.className = type === 'success' 
                ? 'fas fa-check-circle text-green-400 text-xl' 
                : 'fas fa-exclamation-circle text-red-400 text-xl';
            
            // Show toast
            toast.classList.remove('translate-y-full');
            
            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-y-full');
            }, 3000);
        }
        
        // Dark mode toggle (for future implementation)
        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.addEventListener('click', function() {
            document.documentElement.classList.toggle('dark');
        });
        
        // Close modal when clicking outside
        document.getElementById('deleteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDeleteModal();
            }
        });
    </script>
</body>
</html>